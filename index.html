<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GaRaV Galaxy • Eternal Sparks of Love</title>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        body,html{margin:0;padding:0;height:100%;background:#000;background:radial-gradient(circle at center,#0b0e2b 0%,#000 70%);overflow:hidden;color:#fff;font-family:'Segoe UI',sans-serif}
        canvas{position:fixed;top:0;left:0}
        .lang{position:fixed;top:15px;right:15px;z-index:100;color:#aaa;font-size:14px;cursor:pointer}
        .lang span{margin:0 8px;padding:5px 10px;border:1px solid #444;border-radius:8px}
        .lang span.active{border-color:#ff1493;color:#ff1493}
        #title{position:fixed;top:20px;left:20px;font-size:24px;z-index:10;background:rgba(0,0,0,0.5);padding:8px 15px;border-radius:8px}
        #counter{position:fixed;top:20px;right:120px;font-size:22px;z-index:10;background:rgba(0,0,0,0.5);padding:8px 15px;border-radius:8px}
        #sparkBtn{position:fixed;bottom:40px;left:50%;transform:translateX(-50%);padding:18px 44px;background:linear-gradient(45deg,#ff1493,#ff45b3);border:none;border-radius:50px;color:#fff;font-size:22px;cursor:pointer;z-index:10;box-shadow:0 0 40px rgba(255,20,147,.8);transition:.4s}
        #sparkBtn:hover{transform:translateX(-50%) scale(1.1);box-shadow:0 0 60px rgba(255,20,147,1)}
        #form{position:fixed;bottom:120px;left:50%;transform:translateX(-50%);background:rgba(15,15,50,.97);padding:30px;border-radius:20px;z-index:20;display:none;width:380px;text-align:center;box-shadow:0 0 50px rgba(255,20,147,.6)}
        input,select{width:320px;padding:14px;margin:10px 0;border-radius:12px;border:none;font-size:17px;background:#111;color:#fff}
        .btn{padding:14px 30px;margin:10px;border:none;border-radius:12px;cursor:pointer;font-weight:bold;font-size:18px}
        .free{background:#444}
        .love{background:#ff1493}
        .eternal{background:linear-gradient(45deg,gold,#ff8c00);color:#000}
        #manifest{position:fixed;bottom:10px;left:0;right:0;text-align:center;font-size:13px;opacity:.7;line-height:1.7}
    </style>
</head>
<body>
<canvas id="canvas"></canvas>

<div class="lang">
    <span class="active" data-lang="ru">РУС</span> | 
    <span data-lang="en">ENG</span>
</div>

<div id="title">GaRaV Galaxy • Eternal Sparks of Love</div>
<div id="counter">Sparks: 0</div>

<button id="sparkBtn">Light an Eternal Spark ❤️</button>

<div id="form">
    <h3 id="formTitle">Choose your spark</h3>
    <select id="level">
        <option value="free">Free Spark (white)</option>
        <option value="love">$9 • Love Spark (pink + message)</option>
        <option value="eternal">$49 • Eternal Golden Spark + Certificate</option>
    </select>
    <input type="text" id="from" placeholder="Your name or Anonymous">
    <input type="text" id="to" placeholder="For whom">
    <input type="text" id="message" placeholder="Short message (only Love & Eternal)">
    <br><br>
    <button class="btn free" onclick="addSpark('free')">Light for free</button>
    <button class="btn love" onclick="addSpark('love')">Pay $9</button>
    <button class="btn eternal" onclick="addSpark('eternal')">Pay $49</button>
    <button class="btn" style="background:#555" onclick="closeForm()">Cancel</button>
</div>

<div id="manifest">
    GaRaV Galaxy — Galaxy of Universal Mind<br>
    Do not kill • Do not lie • Do not steal<br>
    Human or alien — mind is always a brother
</div>

<script>
    // === ТВОЙ Firebase (тот же самый) ===
    const firebaseConfig = {
      apiKey: "AIzaSyDQIRGVM5ca7K3WCCwTqPqqhjXiUkIk5po",
      authDomain: "garav-sparks-cda52.firebaseapp.com",
      projectId: "garav-sparks-cda52",
      storageBucket: "garav-sparks-cda52.firebasestorage.app",
      messagingSenderId: "1086113078430",
      appId: "1:1086113078430:web:66ccd560cb5ea7de362f8f"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // === Stripe тестовый режим ===
    const stripe = Stripe('pk_test_51Q5exampleOnlyForTestDoNotUseInProduction1234567890'); // заменим на твой позже

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let sparks = [], particles = [], counter = 0;
    let mouseX = 0, mouseY = 0;

    // фон
    for(let i=0;i<120;i++){
        particles.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*1.5+0.5, speed:Math.random()*0.4+0.1});
    }

    window.addEventListener('resize',()=>{canvas.width=innerWidth;canvas.height=innerHeight;});
    canvas.addEventListener('mousemove', e=>{mouseX=e.clientX;mouseY=e.clientY});

    const texts = {
        ru: {
            title: "GaRaV Galaxy • Вечные искры любви",
            btn: "Зажечь вечную Искру ❤️",
            formTitle: "Выбери свою искру",
            free: "Бесплатно (белая)",
            love: "$9 • Искра Любви (розовая + сообщение)",
            eternal: "$49 • Золотая Вечная Искра + Сертификат"
        },
        en: {
            title: "GaRaV Galaxy • Eternal Sparks of Love",
            btn: "Light an Eternal Spark ❤️",
            formTitle: "Choose your spark",
            free: "Free Spark (white)",
            love: "$9 • Love Spark (pink + message)",
            eternal: "$49 • Eternal Golden Spark + Certificate"
        }
    };

    function switchLang(lang){
        document.querySelectorAll('[data-lang]').forEach(el=>el.classList.remove('active'));
        document.querySelector(`[data-lang="${lang}"]`).classList.add('active');
        document.getElementById('title').textContent = texts[lang].title;
        document.getElementById('sparkBtn').textContent = texts[lang].btn;
        document.getElementById('formTitle').textContent = texts[lang].formTitle;
        document.querySelectorAll('#level option')[0].textContent = texts[lang].free;
        document.querySelectorAll('#level option')[1].textContent = texts[lang].love;
        document.querySelectorAll('#level option')[2].textContent = texts[lang].eternal;
    }

    document.querySelectorAll('.lang span').forEach(el=>{
        el.onclick = ()=>switchLang(el.dataset.lang);
    });

    async function loadSparks(){
        const snap = await db.collection("sparks").get();
        sparks = [];
        snap.forEach(doc=>{
            const d=doc.data();
            sparks.push({
                x:Math.random()*(canvas.width-300)+150,
                y:Math.random()*(canvas.height-300)+150,
                from:d.from||"Anonymous",
                to:d.to||"humanity",
                msg:d.message||"",
                level:d.level||"free",
                date:d.timestamp?.toDate().toLocaleDateString()||"forever"
            });
        });
        counter = sparks.length;
        document.getElementById('counter').textContent = `Sparks: ${counter}`;
        draw();
    }

    async function addSpark(level){
        if(level!=='free'){
            const {error} = await stripe.redirectToCheckout({
                lineItems: [{price: level==='love'?'price_test_love':'price_test_eternal', quantity:1}],
                mode: 'payment',
                successUrl: window.location.origin + window.location.pathname,
                cancelUrl: window.location.origin + window.location.pathname
            });
            if(error) alert(error.message);
            return;
        }
        // бесплатная искра
        const from = document.getElementById('from').value.trim()||'Anonymous';
        const to = document.getElementById('to').value.trim()||'someone special';
        await db.collection("sparks").add({
            from, to, level:'free', timestamp:firebase.firestore.FieldValue.serverTimestamp()
        });
        closeForm();
        loadSparks();
    }

    function closeForm(){document.getElementById('form').style.display='none';}
    document.getElementById('sparkBtn').onclick=()=>{document.getElementById('form').style.display='block';};

    function draw(){
        ctx.fillStyle = 'rgba(0,0,0,0.07)';
        ctx.fillRect(0,0,canvas.width,canvas.height);

        particles.forEach(p=>{
            p.y += p.speed;
            if(p.y>canvas.height) p.y=0;
            ctx.fillStyle = 'rgba(255,255,255,0.04)';
            ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
        });

        sparks.forEach(s=>{
            const dist = Math.hypot(mouseX-s.x, mouseY-s.y);
            const hover = dist<70;
            let size = s.level==='eternal'?12:s.level==='love'?8:5;
            size += hover?6:Math.sin(Date.now()/300 + s.x)*1.5;

            ctx.shadowBlur = hover?90:30;
            ctx.shadowColor = s.level==='eternal'?'gold':s.level==='love'?'#ff1493':'#ff1493';
            ctx.fillStyle = s.level==='eternal'?'gold':s.level==='love'?'#ff1493':'#fff';
            ctx.beginPath();
            ctx.arc(s.x,s.y,size,0,Math.PI*2);
            ctx.fill();

            ctx.font = '15px Arial';
            ctx.fillStyle = 'rgba(255,255,255,0.9)';
            ctx.textAlign = 'center';
            let text = `from ${s.from} → to ${s.to}`;
            if(hover && s.msg) text += ` • ${s.msg}`;
            if(hover) text += ` • ${s.date}`;
            ctx.fillText(text, s.x, s.y+35);
        });

        requestAnimationFrame(draw);
    }

    loadSparks();
</script>
</body>
</html>
